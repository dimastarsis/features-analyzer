Привет, я анализатор фича флагов команды `keweb.dc`, умею за пару секунд составить `csv` таблицу с информацией по каждому [флагу v2](https://git.skbkontur.ru/ke/ft/-/blob/master/FileTransfer.Lib/Providers/FeaturesV2/FeatureFlagsModel.cs) (это фича флаги с атрибутом FeatureFlag).
Фича флаги других команд по умолчанию не поддерживаются, но вообще скрипт умеет работать с любыми флагами v2, так, например, я могу собрать информацию по фича флагам `keweb`, для этого в `main.py` поменяй ссылку для `FEATURES_V2_URL`, `CONFIG_URL` (сейчас там прописаны `keweb.dc` url-ы)

## Формат выхода
Скрипт формирует `csv` файл. Значения в таблице разделены по блокам:

#### FeatureFlagV2
это информация, которую скрипт смог распарсить из [модели v2]((https://git.skbkontur.ru/ke/ft/-/blob/master/FileTransfer.Lib/Providers/FeaturesV2/FeatureFlagsModel.cs)) - место где мы храним свои флаги
* Название - название свойства в `.cs` файле модели v2
* Ссылка - ссылка на все места в проекте на гитлаб, где встречается флаг
* Consumer - на кого навешан флаг (абонент, пользователь, портальник)
* Тип - тип значения у флага (`bool`, `int` и т.д.)

#### ClusterConfig
это информация, которую получили из [кластер конфига](https://git.skbkontur.ru/sps/clusterconfig_storage_production/-/blob/default/ft/config) - здесь можно влючать глобально флаги на всех пользователей
* Название - название фича флага в кластер конфиге
* Ссылка - ссылка на все места в кластер конфиге, где встречается флаг
* Значение - значение, которое по умолчанию будет у всех пользователей

#### KeAdmin
это информация, которую получили из [keadmin](https://keadmin.kontur.ru/) - тут можно точечно влючать флаги конкретным пользователям
* Название - название фича флага в админке (keadmin)
* Features - число записей в соответствующей [вкладке](https://keadmin.kontur.ru/Features)
* Настройки пользователей - число записей во [вкладке](https://keadmin.kontur.ru/Adjustments)
* Adjustments - число записей во [вкладке](https://keadmin.kontur.ru/AdjustmentsNew)

#### YouTrack
это информация, которую получили из [youtrack](https://yt.skbkontur.ru)
* Название - название фича флага в ютреке во [вкладке](https://yt.skbkontur.ru/issues/Flag)
* Issues - число найденных issues по флагу

## Запуск

Скрипт делает много запросов в разные апи (`gitlab, keadmin, youtrack`), для каждого нужен свой доступ, напротив каждого названия из `network / .env` файла напиши значение (ковычки опциональные)

* `GITLAB_ACCESS_TOKEN`: в гитлабе зайди во вкладку c [токенами доступа](https://git.skbkontur.ru/-/user_settings/personal_access_tokens), создай токен со скоупом read_api, вставь его значение
* `KEADMIN_AUTH_SID`: после захода на [keadmin](https://keadmin.kontur.ru/) в куках посмотри `auth.sid`
* `YOUTRACK_AUTHORIZATION`: после захода на [youtrack](https://yt.skbkontur.ru) через `web` инспектор (f12) посмотри в запросах параметр `Authorization`, можно глянуть в любом внутреннем запросе ютрека, например `issueListSubscription`

Основные ожидаемые ошибки во время работы - это `401` и `403`, если они произошли, программа в консоль пишет шкалу прогресса, если надпись вида `Загружаем информацию из gitlab`, и не 100%, проверь гитлаб токен (возможно он протух), и так далее.

Запуск через `main.py`, вывод в `feature_flags.csv`